# Moltbot (Clawdbot) 返佣管家 - 功能规格说明书

## 1. 产品概述

**Moltbot (即最新火爆的 Clawdbot)** 若您关注的是近期币圈流行的 AI 代理工具，它们指的通常是同一个技术生态。本项目专为币圈返佣代理商打造，基于此概念构建自动化客户管理系统。通过 Telegram Bot 与交易所 API 的深度集成，实现 **24/7 全天候** 的自动返佣计算、客户服务与精准营销。

**核心价值：**
*   **自动化运营**：无需人工计算返佣，系统每日自动完成。
*   **高额返佣**：支持 OKX (45%) 和 Gate.io (85%) 顶级返佣比例。
*   **精准营销**：建立客户画像，提供个性化服务。
*   **即时响应**：智能关键词识别，秒级回复客户咨询。

---

## 2. 用户角色

系统涉及两种主要用户角色：

| 角色 | 权限与功能 |
| :--- | :--- |
| **普通用户 (客户)** | - 注册获取返佣链接<br>- 绑定交易所 UID<br>- 查询个人返佣记录<br>- 接收每日返佣通知<br>- 获取活动与行情咨询 |
| **管理员 (代理商)** | - 查看系统整体统计数据 (总客户数、总交易量、总返佣)<br>- 接收新用户绑定通知<br>- 接收异常告警<br>- 接收人工介入请求 |

---

## 3. 功能模块详解

### 3.1 Telegram Bot 交互系统

用户通过 Telegram 与系统进行交互，Bot 支持以下指令与功能：

#### 3.1.1 基础指令
*   `/start`：**欢迎与介绍**
    *   显示个性化欢迎语。
    *   介绍 OKX (45%) 和 Gate.io (85%) 返佣优势。
    *   引导用户进行注册或绑定。
*   `/register`：**获取注册链接**
    *   提供 OKX 和 Gate.io 的专属高返佣注册链接。
    *   展示注册后如何绑定 UID 的说明。
*   `/rebate`：**查询返佣记录**
    *   查询用户累计交易量、产生的总手续费及应得返佣金额。
    *   若无数据，引导用户注册或交易。
*   `/help`：**帮助中心**
    *   列出常用指令。
    *   解答常见问题 (如：返佣到账时间、如何联系客服)。

#### 3.1.2 智能关键词回复
系统自动监听群聊/私聊消息，识别以下关键词并回复：
*   **返佣/佣金/Rebate**：介绍高额返佣比例，引导注册。
*   **手续费/Fee/贵**：强调省钱优势，对比手续费差异。
*   **注册/开户/邀请码**：发送注册引导和链接。
*   **人工/客服/投诉**：触发人工介入机制，立即通知管理员。

#### 3.1.3 账户绑定
用户发送特定格式消息即可自动绑定账户：
*   格式：`OKX UID: 123456` 或 `Gate UID: 123456`
*   系统自动验证 UID 格式，绑定成功后立即生效。
*   绑定成功后，管理员会收到通知。

---

### 3.2 自动化返佣核心

系统后台每日自动执行以下核心流程：

#### 3.2.1 数据同步
*   **频率**：每日 00:00 (UTC+8)
*   **OKX 数据**：通过 Broker API 拉取下级用户交易数据。
*   **Gate.io 数据**：通过 Rebate API 获取佣金历史记录。

#### 3.2.2 佣金计算
*   **计算公式**：
    *   OKX 返佣 = 交易手续费 × 45%
    *   Gate.io 返佣 = 交易手续费 × 85%
*   系统自动将交易所原始数据转换为用户应得返佣。

#### 3.2.3 每日通知推送
*   系统自动筛选昨日有交易产生的用户。
*   通过 Telegram Bot 向用户发送私聊消息：
    *   昨日交易量
    *   获得返佣金额
    *   累计返佣金额

---

### 3.3 客户管理系统 (CRM)

系统内置轻量级 CRM 功能：

*   **客户档案**：记录 Telegram ID、用户名、注册时间、绑定的交易所 UID。
*   **交易画像**：记录用户偏好的交易所 (OKX/Gate) 和交易活跃度。
*   **长期记忆**：不仅存储数据，还保留对话上下文 (未来扩展基础)。

---

### 3.4 管理员后台与监控

管理员通过特定指令或私聊获取系统状态：

*   `/stats`：**系统统计概览**
    *   总客户数
    *   今日新增客户数
    *   系统总交易量 & 总返佣金额
*   **实时通知**：
    *   新用户绑定提醒。
    *   系统异常/API 错误告警。
    *   用户请求人工客服提醒。

---

## 4. 技术规格

### 4.1 系统架构
*   **开发语言**：TypeScript (Node.js)
*   **数据库**：SQLite (sql.js) - 轻量、高效、易迁移
*   **机器人框架**：Telegraf
*   **部署方式**：Docker 容器化部署

### 4.2 安全性
*   **API 安全**：密钥通过环境变量隔离，不硬编码。
*   **数据安全**：SQL 参数化查询，防止注入攻击。
*   **权限控制**：敏感指令 (`/stats`) 仅限管理员 ID 调用。

### 4.3 性能指标
*   **响应速度**：Bot 回复 < 1秒。
*   **并发处理**：支持数百个并发用户请求。
*   **数据一致性**：确保返佣计算精确到小数点后 8 位 (Satoshis)。

---

## 5. 未来规划 (Roadmap)

1.  **多语言支持**：增加英文/韩文界面，拓展国际市场。
2.  **USDT 自动转账**：对接链上支付接口，实现返佣自动到账钱包。
3.  **更强的 AI 智能**：集成 GPT-4/Claude 3，实现更自然的对话和行情分析功能。
